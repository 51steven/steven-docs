MySQL 进阶（下）
====================
# 1 分区
## MySQL 分区
一般情况下，我们创建的表对应一组存储文件，如：使用 Innodb 存储引擎时是一个 .ibd 和 .frm（表结构）文件。当数据量较大时（一般千万条记录级别以上），MySQL的性能就会开始下降，这时我们就需要将数据分散到多组存储文件，保证其单个文件的执行效率。

分区的作用：
- 逻辑数据分割
- 提高单一的写和读应用速度
- 提高分区范围读查询的速度
- 分割数据能够有多个不同的物理文件路径
- 高效的保存历史数据

查看当前数据库是否支持分区：
```Text
- MySQL5.6 以及之前版本
SHOW VARIABLES LIKE '%partition%';
- MySQL5.6
show plugins;
```
## 分区类型及操作
- RANGE 分区：基于属于一个给定连续区间的列值，把多行分配给分区。mysql 将会根据指定的拆分策略，把数据放在不同的表文件上。相当于在文件上，被拆成了小块。但是,对外给客户的感觉还是一张表，透明的。按照 range 来分，就是每个库一段连续的数据，这个一般是按比如时间范围来的，如：交易表、销售表等，可以根据年月来存放数据。可能会产生热点问题，大量的流量都打在最新的数据上了。range 来分，好处在于，扩容的时候很简单。

- LIST 分区：类似于按RANGE分区，每个分区必须明确定义。它们的主要区别在于，LIST分区中每个分区的定义和选择是基于某列的值从属于一个值列表集中的一个值，而RANGE分区是从属于一个连续区间值的集合。

- HASH 分区：基于用户定义的表达式的返回值来进行选择的分区，该表达式使用将要插入到表中的这些行的列值进行计算。这个函数可以包含 MySQL 中有效的、产生非负整数值的任何表达式。hash 分发，好处在于，可以平均分配每个库的数据量和请求压力；坏处在于说扩容起来比较麻烦，会有一个数据迁移的过程，之前的数据需要重新计算 hash 值重新分配到不同的库或表

- KEY 分区：类似于按HASH分区，区别在于KEY分区只支持计算一列或多列，且MySQL服务器提供其自身的哈希函数。必须有一列或多列包含整数值。

## 分区的局限性
- 分区表，分区键设计不太灵活，如果不走分区键，很容易出现全表锁；
- 一旦数据并发量上来，如果在分区表实施关联，就是一个灾难；
- 自己分库分表，自己掌控业务场景与访问模式，可控。分区表，研发写了一个sql，都不确定mysql是怎么玩的，不太可控。

# 2 分表、分库



# 参考：
- [MySQL 万字精华总结](https://www.jianshu.com/p/c189439fb32e)

